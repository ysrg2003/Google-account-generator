name: Enterprise Web Automation Engine

on:
  workflow_dispatch: # ุชุดุบูู ูุฏูู ุฏููู

jobs:
  run-core:
    runs-on: ubuntu-latest
    timeout-minutes: 20 # ุฒูุงุฏุฉ ุงูููุช ููููุงู ูุถูุงู ุฅุชูุงู ูุงูุฉ ุนูููุงุช "ุงูุชุฎุทู"

    steps:
      - name: ๐ฅ ุณุญุจ ุงูููุฏ
        uses: actions/checkout@v4

      - name: ๐ ุฅุนุฏุงุฏ ุจุงูุซูู 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: โก ูุงุด ุงููุชุตูุญ ูุงูุงุนุชูุงุฏูุงุช
        uses: actions/cache@v4
        id: cache-deps
        with:
          path: |
            ~/.cache/pip
            ~/.cache/ms-playwright
          key: ${{ runner.os }}-automation-v2-${{ hashFiles('**/requirements.txt') }}

      - name: ๐๏ธ ุชุซุจูุช ุงููุญุฑู ูุงูุงุนุชูุงุฏูุงุช
        run: |
          # ุชุฃูุฏ ูู ูุฌูุฏ Faker ู Camoufox ูู requirements.txt
          pip install faker camoufox[nimbus] playwright
          if [ "${{ steps.cache-deps.outputs.cache-hit }}" != "true" ]; then
            python -m playwright install firefox --with-deps
          fi
          sudo python -m playwright install-deps firefox

      - name: ๐ ุชุดุบูู ุงููุญุฑู (Deep Execution)
        run: python main.py
        env:
          PYTHONUNBUFFERED: 1 
          # ูููู ุฅุถุงูุฉ ูุชุบูุฑุงุช ุจูุฆุฉ ููุง ุฅุฐุง ุฃุฑุฏุช ุงูุชุญูู ูู ุงูุณุฑุนุฉ ุฃู ุนุฏุฏ ุงููุญุงููุงุช

      - name: ๐ ุชุตุฏูุฑ ุงูุญุฒูุฉ ุงูุชูุซูููุฉ ุงูุดุงููุฉ
        if: always() # ูุถูุงู ุฑูุน ุงูุชูุงุฑูุฑ ุญุชู ูู ุญุงู ูุดู ุงูุณูุฑุจุช (ูุฑุคูุฉ ููุทุฉ ุดุงุดุฉ ุงูุฎุทุฃ)
        uses: actions/upload-artifact@v4
        with:
          name: Full-Trace-Report-Session-${{ github.run_number }}
          # ุงูุชุนุฏูู ููุง: ูุณุชุฎุฏู ุงูููุท TRACE_REPORT_* ููุทุงุจู ุงููุฌูุฏุงุช ุงูุชู ููุดุฆูุง ุงูููุฏ
          path: |
            TRACE_REPORT_*
            PRO_ENGINE_*
            *.json
          retention-days: 14
