name: Enterprise Web Automation Engine

on:
  workflow_dispatch: # ุชุดุบูู ูุฏูู

jobs:
  run-core:
    runs-on: ubuntu-latest
    timeout-minutes: 25

    steps:
      - name: ๐ฅ ุณุญุจ ุงูููุฏ ุงููุตุฏุฑู (Checkout)
        uses: actions/checkout@v4

      - name: ๐ ุฅุนุฏุงุฏ ุจุงูุซูู 3.11 (Python Setup)
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ๐๏ธ ุจูุงุก ุงูุจูุฆุฉ ูุชุซุจูุช ุงููุญุฑู
        run: |
          # 1. ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
          python -m venv venv
          source venv/bin/activate
          
          # 2. ุชุญุฏูุซ ุงูุฃุฏูุงุช ูุชุซุจูุช ุงูููุชุจุงุช
          python -m pip install --upgrade pip setuptools wheel
          pip install faker camoufox[nimbus] playwright
          
          # 3. ุงูุญู ุงูููุงุฆู ููุดููุฉ playwright command not found:
          # ูุณุชุฎุฏู python -m ูุถูุงู ุงููุตูู ููููุชุจุฉ ุฏุงุฎู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
          # ููุณุชุฎุฏู --with-deps ูุชุซุจูุช ุงุนุชูุงุฏุงุช ุงููุธุงู ุชููุงุฆูุงู ุจุฏูู ุชุนุงุฑุถุงุช sudo
          python -m playwright install firefox --with-deps

      - name: ๐ ุชุดุบูู ุงููุญุฑู (Deep Execution)
        run: |
          source venv/bin/activate
          # ุถูุงู ุธููุฑ ุงูุณุฌูุงุช ููุฑุงู
          export PYTHONUNBUFFERED=1
          python main.py
        env:
          PYTHONUNBUFFERED: 1

      - name: ๐ ุชุตุฏูุฑ ุงูุญุฒูุฉ ุงูุชูุซูููุฉ (Full Forensic Report)
        if: always() # ูุฐุง ุงูุณุทุฑ ูุถูู ุฑูุน ุงูุตูุฑ ูุงูุชูุงุฑูุฑ ุญุชู ูู ูุดู ุงูุณูุฑุจุช
        uses: actions/upload-artifact@v4
        with:
          name: Full-Trace-Report-Run-${{ github.run_number }}
          path: |
            PRO_ENGINE_*
            *.json
            *.log
          retention-days: 14
